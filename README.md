# Turms

Turms是一款完全免费开源、易于集群部署、健壮、方便拓展、运作高效、安全且业务独立的Java即时通信服务端程序。

开源时间为：2019年10月13日。开源内容为：

1. turms服务端 v0.8

2. turms-admin v0.8

3. turms-client-js v0.8

4. turms-client-dart v0.8

5. turms-client-flutter-demo v0.8

## 配套组合

| 范围        | 类别               | 功能描述                                                     | 名称                                                         |
| ----------- | ------------------ | ------------------------------------------------------------ | ------------------------------------------------------------ |
| Turms服务端 | 自定义插件实现接口 | 在数据（如用户消息）流入或流出的时候，或事件（如用户上下线事件）触发的时候，对应的自定义插件将被触发以实现各种各样定制功能 | [turms-plugin](https://github.com/turms-im/turms-plugin)     |
| Turms服务端 | CMS+APM            | 为Turms服务端集群提供：运营数据统计、内容管理、集群监控与管理等功能 | [turms-admin](https://github.com/turms-im/turms-admin)       |
| Turms客户端 | 通讯能力库         | 除了实现显而易见的业务功能外，关键还实现了与Turms服务端的交互逻辑（如消息去重、心跳检查等），对调用者透明。您在使用该库时，无需关系背后的逻辑 | [turms-client-js](https://github.com/turms-im/turms-client-js) |
| Turms客户端 | 通讯能力库         | 除了实现显而易见的业务功能外，关键还实现了与Turms服务端的交互逻辑（如消息去重、心跳检查等），对调用者透明。您在使用该库时，无需关系背后的逻辑 | [turms-client-dart](https://github.com/turms-im/turms-client-dart) |
| Turms客户端 | UI组件(Unplanned)  |                                                              | [turms-client-ui-flutter](https://github.com/turms-im/turms-client-ui-flutter) |
| Turms客户端 | Demo               | 基于turms-client-dart库与Flutter编写的客户端Demo。此Demo仅基于同一套代码编写，但能同时运行于手机端（Android、iOS）与桌面端（Windows、MacOS、Linux）<br />（暂无计划运行于浏览器中） | [turms-client-flutter-demo](https://github.com/turms-im/turms-client-flutter-demo) |

注意：出于对开发成本与维护成本的考虑，Turms暂不提供在Android（Java/Kotlin）与iOS（Swift/Objective-C）平台中Turms客户端的原生实现，而是提供了基于具有跨平台能力的JavaScript与Dart语言的客户端实现。

## 主要特性

1. 功能完善性。Turms支持几乎所有商用即时通信产品所支持的即时通信相关功能，并且无任何增值功能收费，无需提交工单以申请功能，无业务功能限制。
2. 功能拓展性。Turms同时支持两种拓展模式。配置参数；自定义Plugin插件。当然您也完全可以对源码进行修改。未来接入ElasticSearch集群部分就将基于Plugin实现。
3. 配置灵活性。Turms提供了上百个配置参数供用户定制，以满足各种即时通信场景。
4. 部署简易性。Turms集群中仅有Turms服务端节点，默认无需为第三方服务端部署服务器。
5. 集群健壮性。Turms服务端通过Hash Slot与选举算法来保证在部分集群节点宕机的情况下，Turms集群仍能正常运作。
6. 存储可靠性。在每个Turms节点服务器中，都搭配了CockRoachDB用于消息存储与容灾，即高效又可靠。
7. 运作高效性。Turms服务端与Turms客户端间的所有通信数据均为Protobuf二进制数据。同时各功能模块充分利用内存，通过本地缓存高效运作。
8. 业务可插拔性。Turms服务端集群独立于您的业务逻辑服务端。

## Quick Start

- 下载并解压Turms服务端压缩包
- 下载并解压CockRoachDB压缩包，将“cockroach.exe”文件（Windows平台）或“cockroach”文件（Linux平台）放到Turms服务端目录下的"/cockroachdb"文件夹下
- 运行Turms服务端可执行脚本（或执行命令“turms start”）
- 在多台服务器上重复以上步骤，Turms服务端将默认通过组播方式寻找其他Turms服务端节点，由此Turms集群开始运作

提醒：上述操作主要用于您初次体验Turms集群使用，若您需将Turms部署在生产环境当中，请查阅Wiki手册，以了解Turms的各种配置，来定制您自己的业务需求。

## 业务功能列表

1. 在业务功能列表处，有部分功能标注了“✍”，该图标用于表明“是否执行该业务功能点的判定逻辑，需由开发者结合自身业务应用场景，自行判断并调用相关API。Turms自身无法判定当前Context是否满足触发该功能点的条件”。
2. 此功能列表参考了：网易云信、环信、融云、LeanCloud、腾讯云通讯等商用即时通信服务。Turms提供了几乎所有这些商业服务所提供的业务功能，并在一些方面更上一层楼。
3. 本功能列表仅为功能概述。如果您需要了解具体实现的参数配置、完整方案与原理，请查阅对应的Wiki内容。
4. 提醒：Turms的功能配置参数极其自由，您甚至可以配置一个群组上限成员数量为10,000，单个消息上限100MB，关闭大部分业务功能等等的配置，拓展将消息转发给所有的用户等等的功能，Turms服务端不会干涉您满足任何的业务场景。
   Turms只是为您提供了最通用的配置，如默认一个群的上限人数为500，单个消息最大可为1MB等等。
5. 如果您未在此列表中找到您所需要的功能，请先检查是否您的需求仅需配置Turms参数即可实现。确认无法通过Turms配置参数实现后，请再在Issue区域提出。Turms会根据“性价比”进行评估，并尽可能满足您的需求。
6. 关于“实现版本”。此处所述的实现版本号均为保守评估的功能实现版本号，实际情况通常是<提前完成并提前引入>。并且Turms的版本号设计并不完全遵循 [Semantic Versioning](https://github.com/semver/semver/blob/master/semver.md)，Turms的大版本号主要由关键功能的引入而推动。在涉及Breaking Changes的部分会单独提出。

### 多端登录类型

提醒：Turms允许您通过参数来自己定制哪些设备能同时登陆，哪些设备不能同时登陆。以下仅是常见的多端登陆类型搭配，供您快速挑选实现。

“设备类型”指的是：Android、iOS、PC、Web、Unknown、Others

| **常见类型**                                                 | **功能描述** | **相关配置** | **实现版本** |
| :----------------------------------------------------------- | ------------ | ------------ | :----------- |
| 允许每种设备类型的一个设备都能同时在线                       |              |              | 0.8.0 ✔      |
| 仅允许一个设备类型的一个设备同时在线                         |              |              | 0.8.0 ✔      |
| 允许PC端的一个设备与手机端的一个设备同时在线                 |              |              | 0.8.0 ✔      |
| 允许PC端或者Web端的一个设备，与手机端的一个设备同时在线      |              |              | 0.8.0 ✔      |
| 允许PC端的一个设备，与Web端的一个设备，与手机端的一个设备同时在线 |              |              | 0.8.0 ✔      |
| 允许PC端或手机端的一个设备同时在线                           |              |              | 0.8.0 ✔      |
| 允许PC端或手机端或Wb端的一个设备同时在线                     |              |              | 0.8.0 ✔      |

注意：

- 任何多端登陆类型都不允许一个用户账号在一种设备上有多个同时登陆的设备
- 当用户登陆设备的类型有Unkown或Others情况时，需进行额外配置：允许Unkown/Others设备与其他已知设备同时登陆、不允许Unkown/Others设备与其他已知设备同时登陆

### 多端登陆冲突解决策略

| **类型**           | **功能描述**                                       | **相关配置** | **实现版本** |
| :----------------- | -------------------------------------------------- | ------------ | :----------- |
| 已上线设备掉线     | 已上线的设备掉线                                   |              | 0.8.0 ✔      |
| 请求已上线设备确认 | 已上线的一方获得通知，同意或拒绝预上线设备上线请求 |              | 0.8.0 ✔      |
| 预上线设备上线失败 | 准备上线的一方直接上线失败                         |              | 0.8.0 ✔      |

### 业务消息类型

提醒：

- 虽然Turms服务端默认支持传递与存储图片、视频、文件等数据的功能，但极其不推荐使用此实现方案。
  推荐的实现方案是使用CDN技术，客户端将文件上传到CDN后，再将从CDN那获得的文件URL传递给Turms服务端，由Turms保存这个URL文本，而不保留文件的二进制数据。或是采用未来Turms提供的小文件管理集群并配合插件来自主部署文件管理服务集群。
- Turms的内部实现保证了您的用户永远能正确收到“消息已发送”或“消息已接收”，在极端恶劣情况下，也不会出现“告知消息已发送/接收，但实际并未发送或接收”的情况。

#### 基础内容类消息类型

| **消息类型** | **功能描述**                                                 | **相关配置** | **实现版本** |
| :----------- | :----------------------------------------------------------- | ------------ | :----------- |
| 文本消息     | 消息内容为普通文本                                           |              | 0.8.0 ✔      |
| 图片消息     | 消息内容为描述部分（可选）：图片 URL 地址、尺寸、图片大小<br />图片数据（可选） |              | 0.8.0 ✔      |
| 语音消息     | 消息内容为描述部分（可选）：语音文件的 URL 地址、时长、大小、格式<br />语音数据（可选）<br />语音消息最大时长默认为 120 秒 |              | 0.8.0 ✔      |
| 视频消息     | 消息内容为描述部分（可选）：视频文件的 URL 地址、时长、大小、格式<br />视频数据（可选）<br />视频消息最大时长默认为 30 秒 |              | 0.8.0 ✔      |
| 文件消息     | 消息内容为描述部分（可选）：文件的 URL 地址、大小、格式<br />文件数据（可选）<br />默认最大支持 16 MB |              | 0.8.0 ✔      |
| 地理位置消息 | 消息内容为地理位置标题、地址、经度、纬度信息                 |              | 0.8.0 ✔      |

#### 其他消息类型

| **消息类型**   | **功能描述**                                                 | **相关配置** | **实现版本** |
| :------------- | :----------------------------------------------------------- | ------------ | :----------- |
| 组合内容类消息 | 消息内容为文本信息与任意个数的其他任何内容类消息类型的消息（如一条消息既有文本，也图片与音频） |              | 0.8.0 ✔      |
| 通知消息       | 自身并不携带消息内容的通知类消息。主要用于如添加好友、群组邀请、撤回消息、已读回执等的通知 |              | 0.8.0 ✔      |
| 自定义消息     | 开发者通过“组合内容类消息”自定义的消息类型，例如红包消息、石头剪子布等形式的消息 |              | 0.8.0 ✔      |
| 系统消息       | 基础内容类消息类型与组合内容类消息均可作为系统消息           |              | 0.8.0 ✔      |

### 消息功能

| **消息功能** | **功能描述**                                                 | **相关配置** | **实现版本** |
| :----------- | :----------------------------------------------------------- | ------------ | :----------- |
| 离线消息     | Turms客户端会在每次用户登陆时，都<主动>向Turms服务端发送关于<该用户在离线状态时，收到的所有私聊与群聊各自具体的离线消息数量，以及各自具体的最后N条消息（默认为1条）>，以此同时兼顾消息的实时性与服务的性能。 默认情况下，Turms服务端<不会>定时删除寄存在Turms服务端的任何离线消息 |              | 0.8.0 ✔      |
| 漫游消息     | ✍在新设备登录时，由开发者自行调用Turms客户端的消息查询接口，指定数量与时段等条件，向Turms服务端请求的漫游消息。<br />漫游消息的实现本质与“历史消息”的实现一样<br />（✍原因：Turms无法自行判断什么是“新设备登陆”） |              | 0.8.0 ✔      |
| 多端同步     | 当一名用户有多客户端同时在线时，Turms服务端会将消息下发给该用户所有在线的客户端 |              | 0.8.0 ✔      |
| 历史消息     | 支持查询用户的历史消息。默认Turms永久存储消息（包括用户消息或系统消息）<br />历史消息的实现本质与“漫游消息”的实现一样 |              | 0.8.0 ✔      |
| 消息撤回     | 撤回投递成功的消息，默认允许发信人撤回距投递成功时间 2 分钟内的消息 |              | 0.8.0 ✔      |
| 消息编辑     | 编辑已发送成功的消息                                         |              | 0.8.0 ✔      |
| 阅后即焚     | 收信人接收到发信人的消息后，收信人客户端会根据发信人预先设定（或默认）的时间按时自动销毁 |              | 0.8.0 ✔      |
| 已读回执     | ✍通知私聊对象或群组成员中，当前用户已读某条消息<br />查看私聊、群组会话中对方的已读/未读状态<br />（✍原因：Turms无法得知您的用户在什么情况下算是“已读某条消息”。开发者需要自行调用turmsClient.outbound.sendReadReceipt()来告知对方，当前用户已读某条消息） |              | 0.8.0 ✔      |
| 消息转发     | 将消息转发给其他用户或群组                                   |              | 0.8.0 ✔      |
| @某人        | 用于特别提醒某用户。如果Turms客户端检测到已接收的消息中被@的用户为当前登陆中的用户，Turms客户端则会触发@回调函数。开发者可自行实现后续相关业务逻辑。常用于给被@的用户提醒通知。<br />群内 @ 消息与普通消息没有本质区别，仅是在被 @ 的人在收到消息时，需要做特殊处理（触发回调函数） |              | 0.8.0 ✔      |
| 正在输入     | ✍当通信中的一方正在键入文本时，告知收信人（一名或多名用户），该用户正在输入消息<br />（✍原因：Turms无法得知您的用户是否正在键入文本） |              | 0.8.0 ✔      |

### 用户资料功能

| **功能**             | **功能描述**                                                 | **相关配置** | 实现版本 |
| :------------------- | :----------------------------------------------------------- | ------------ | -------- |
| 设置用户资料         | 用户设置自己的昵称、介绍、头像URL                            |              | 0.8.0 ✔  |
| 获取用户资料         | 用户查看自己或其他用户的资料                                 |              | 0.8.0 ✔  |
| 设置用户资料访问权限 | 用户可以针对个人的每项资料设置访问权限。访问权限有：所有人可见、好友可见、仅自己可见 |              | 0.8.0 ✔  |

### 用户关系托管

概念区分：在Turms中，
①“关系人”（Related Users）指的是存在“好友”或“拉黑用户”关系的、不管在不在联系人列表的两名用户，因此在“关系人分组”里即可以有好友，也可以有拉黑用户。**关系人记录中最重要的信息就是二者“是否是联系人”与“用户关系（好友/拉黑用户）”**
②“联系人”（Contacts）指的是存在“好友”或“拉黑用户”关系的、在联系人列表的两名用户，因此“联系人”必定是“关系人”，但“关系人”不一定是“联系人”。
在一般的社交应用中，“关系人分组”概念被“缩小”使用，仅用于表示“具有好友关系的联系人分组”。

| **功能**                     | **功能描述**                                                 | **相关配置** | **实现版本** |
| :--------------------------- | :----------------------------------------------------------- | ------------ | :----------- |
| 获取关系人列表               | 根据可选的过滤（如“是否是联系人”、“是否是好友/拉黑用户”等）与分组条件，获取用户的关系人名单 |              | 0.8.0 ✔      |
| 添加关系人(+发起好友请求)    | ①若是添加关系为“好友”的<关系人>，则根据您自定义的Turms服务端配置，用户既可直接添加<关系人>，亦可先发起好友请求，待获得批准后，才可执行添加操作。<br />（提醒：在一般社交应用中，“好友”指的是“关系为好友的联系人”。但在Turms中，“好友”指的是“关系为好友的关系人”，即：“好友”不一定是“联系人”）<br />②若是添加关系为“拉黑用户”的关系人，则直接生效，无需批准。用户将不再收到拉黑用户发来的任何消息或者请求。<br />但注意：拉黑用户可以同时是“联系人”，需由开发者根据自身业务场景在拉黑的同时更新“是否是联系人”信息 |              | 0.8.0 ✔      |
| 通过/拒绝好友请求            | 用户可以通过或者拒绝好友请求                                 |              | 0.8.0 ✔      |
| 删除关系人                   | 根据可选删除条件（如“是/不是联系人”、“是好友/拉黑用户”），删除某类关系人或指定关系人。<br />提醒：删除关系记录，意味着同时删除二者关于“是否是联系人”与“用户关系（好友/拉黑用户）”信息 |              | 0.8.0 ✔      |
| 修改关系人信息               | 修改“是/不是联系人”与“用户关系（好友/拉黑用户）”信息。在修改关系为“好友”时，需要进行先发送好友请求（您可以取消此步骤） |              | 0.8.0 ✔      |
| 判断用户与其他指定用户的关系 | 判断某用户与其他指定用户的关系（不存在关系+好友关系/拉黑用户关系） |              | 0.8.0 ✔      |
| 创建关系人分组               | 创建分组时，可以同时指定分组名与被添加的关系人。同一关系人可以被添加到多个分组 |              | 0.8.0 ✔      |
| 删除关系人分组               | 删除关系人分组，同时可以可选是否转移被删除关系人分组中的关系人到其他分组（若不指定，则默认分配到“默认分组”） |              | 0.8.0 ✔      |
| 重命名关系人分组             | 重命名关系人分组                                             |              | 0.8.0 ✔      |
| 获取用户自己的关系人分组信息 | 获取用户自己的关系人分组信息                                 |              | 0.8.0 ✔      |
| 添加关系人到某分组           | 将关系人添加到关系人分组                                     |              | 0.8.0 ✔      |
| 从某分组中删除关系人         | 将关系人从关系人分组中删除                                   |              | 0.8.0 ✔      |

### 用户其他功能

| **功能** | 实现概要                                                     | **功能描述**                       | **相关配置** | **实现版本** |
| -------- | ------------------------------------------------------------ | ---------------------------------- | ------------ | ------------ |
| 附近的人 | 各Turms服务端基于R*-tree算法（Experimental）管理与自身连接的在线用户的地理坐标 | 根据当前实时坐标搜寻附近的其他用户 |              | 0.8.0 ✔      |

### 群组功能

在Turms中，不对群组、聊天室等概念做区分，Turms统一使用“群组”这一概念。用户可在创建群组或更新群组属性时，配置各种各样的群组业务功能，以定制各种类型的“群组”。

| **功能**             | **功能描述**                                                 | **相关配置** | **实现版本**         |
| :------------------- | :----------------------------------------------------------- | ------------ | :------------------- |
| 群容量               | 默认群组上线人数为 500 人/群，无上限                         |              | 0.8.0 ✔              |
| 群资料属性           | 群名，群头像，群简介，群公告，群扩展字段                     |              | 0.8.0 ✔              |
| 查找群组             | 可通过群组 ID 查找群组<br />（补充：由于通过昵称来查找群组功能的高效实现较复杂，因此放到0.9.0版本实现，预计采用AC自动机算法） |              | 0.8.0 ✔<br />0.9.0 ❓ |
| 邀请入群             | 支持配置：仅群主可邀请、仅群主+管理员可邀请、群主+管理员+群成员可邀请、所有人可邀请 |              | 0.8.0 ✔              |
| 被邀请人同意模式     | 支持配置：需要被邀请人同意、不需要被邀请人同意               |              | 0.8.0 ✔              |
| 申请入群             | 支持                                                         |              | 0.8.0 ✔              |
| 入群验证             | 支持配置：群主与管理员审批入群请求、入群请求者回答问题正确后加入、允许任何人加入、不允许任何人加入 |              | 0.8.0 ✔              |
| 群成员类型           | 群主、管理员、普通成员、游客、匿名游客                       |              | 0.8.0 ✔              |
| 管理员设置           | 群主可以增减管理员                                           |              | 0.8.0 ✔              |
| 群组资料修改权限     | 支持配置：仅群主可修改、仅群主与管理员可修改、仅群主+管理员与群成员可修改、所有人可修改 |              | 0.8.0 ✔              |
| 群扩展字段修改权限   | 支持配置：仅群主可修改、仅群主与管理员可修改、仅群主+管理员与群成员可修改、所有人可修改 |              | 0.8.0 ✔              |
| 修改群成员昵称       | 群主可以修改所有人的群昵称。管理员只能修改普通群成员的群昵称 |              | 0.8.0 ✔              |
| 修改自己的群昵称     | 支持                                                         |              | 0.8.0 ✔              |
| 消息类型支持         | 同基础消息类型                                               |              | 0.8.0 ✔              |
| 消息提醒             | 接收提醒、只接收管理员消息提醒、不接收提醒                   |              | 0.8.0 ✔              |
| 历史消息             | 支持云端历史消息，默认服务端存储最近 1 年的历史记录          |              | 0.8.0 ✔              |
| 离线消息             | 每个群聊会话最多下发 500 条离线消息（懒加载）                |              | 0.8.0 ✔              |
| 消息漫游             | 默认同步最近 7 天的所有消息（懒加载）                        |              | 0.8.0 ✔              |
| 指定成员强制推送     | 支持                                                         |              | 0.8.0 ✔              |
| 群消息已读回执       | 支持                                                         |              | 0.8.0 ✔              |
| 踢人                 | 群主和管理员可以踢人，且管理员不能踢群主和其他管理员         |              | 0.8.0 ✔              |
| 主动退群             | 除群主外，其他用户均可以主动退群。群主需先将群转让给其他群成员才可以进行退群操作 |              | 0.8.0 ✔              |
| 转让群               | 群主可以将群的拥有者权限转给群内的其他成员，转移后， 被转让者变为新的群主，原群主变为普通成员。群主还可以选择在转让的同时，直接退出该群 |              | 0.8.0 ✔              |
| 解散群               | 群主可以解散群                                               |              | 0.8.0 ✔              |
| 修改群组开/关状态    | 修改群组开/关闭状态，仅支持从服务端修改                      |              | 0.8.0 ✔              |
| 群组黑名单           | 用户被拉黑后，将无法再进入群组。如果被拉黑用户在被拉黑之前是当前群组成员，则在拉黑后该用户会自动在群组成员列表中移除 |              | 0.8.0 ✔              |
| 群组成员禁言         | 禁言用户可以在群组内，但无法发送消息                         |              | 0.8.0 ✔              |
| 群组临时禁言         | 群组支持设置临时禁言时长，禁言时长时间到了，自动取消禁言     |              | 0.8.0 ✔              |
| 群组永久禁言         | 设置群组整体禁言状态，仅创建者和管理员能发言                 |              | 0.8.0 ✔              |
| 群组成员坐标实时共享 | 群组成员可以将自己的坐标实时地分享给其他群组成员             |              | 0.9.0 ❓              |

## 管理功能列表（非完全）

此表所述功能主要供：①您的后端程序调用；②同时作为内容统计管理系统与集群监控管理系统的turms-admin使用。具体API接口文档，请查阅[Turms服务端集成开发文档]()

**注意：**

- **此表所述接口仅供管理员使用，而不应该被用户使用**。因为这些操作不在业务层上做权限判断，如场景：用户A请求添加B为联系人。在业务层中，是需要判断用户A是否有权限添加用户B的。但在下表所述接口中，它们不会做业务权限判断，而直接执行添加联系人操作（因为无需对管理员进行业务层权限判断）
- Turms面向管理员使用的API接口并不是完全按照RESTful风格设计的，Turms的API接口的设计原则是“接口的规范性要以开发者使用便捷为前提”，而不是“为了接口规范，需要开发者进行多余的繁琐操作”

### 管理员权限管理

每个Turms集群默认存在一个userId为“turms”，password为“turms”的超级管理员

| **功能**       | **功能说明**                               | **URL**        | **实现版本** |
| :------------- | :----------------------------------------- | -------------- | ------------ |
| 管理员身份校验 | 告知请求发起者，其发送的管理员信息是否存在 | HEAD /admins   | 0.8.0 ✔      |
| 获取管理员名单 |                                            | GET /admins    | 0.8.0 ✔      |
| 新建管理员     |                                            | POST /admins   | 0.8.0 ✔      |
| 删除管理员     |                                            | DELETE /admins | 0.8.0 ✔      |
| 修改管理员信息 | 包括修改管理员的权限                       | PUT /admins    | 0.8.0 ✔      |

### 消息管理

| **功能**     | **功能说明**                                               | **URL**          | **实现版本** |
| :----------- | :--------------------------------------------------------- | ---------------- | ------------ |
| 获取消息     | 根据自定义的过滤条件，获取消息                             | GET /messages    | 0.8.0 ✔      |
| 消息全文检索 | （Planned）预计基于hanLP与CoreNLP分词实现                  | GET /messages    | 1.x ❓        |
| 发送消息     | 可发送的消息类型同“业务功能列表”中的消息类型               | POST /messages   | 0.9.0 ❓      |
| 删除消息     | 删除消息                                                   | DELETE /messages | 0.8.0 ✔      |
| 修改消息     | 可修改消息的所有字段信息，并在修改消息后可选是否重发此消息 | PUT /messages    | 0.9.0 ❓      |

### 用户管理

| **功能**           | **功能说明**                                                 | **URL**                 | **实现版本** |
| :----------------- | :----------------------------------------------------------- | ----------------------- | ------------ |
| 获取用户信息       | 根据用户ID或分页信息，获取用户的非敏感信息或完整信息。<br />注意：此处获取的用户密码既可以是密文（默认salt+SHA256），也可以是明文。由您配置的参数决定（默认密文） | GET /users              | 0.8.0 ✔      |
| 添加用户账号       | 添加用户账号                                                 | POST /users             | 0.8.0 ✔      |
| 删除用户账号       | 删除用户账号。可指定是否同时删除，用户的联系人列表与被联系人列表 | DELETE /users           | 0.8.0 ✔      |
| 修改用户信息       | 可修改用户所有字段信息。包括禁用/解禁用户                    | PUT /users              | 0.8.0 ✔      |
| 获取用户在线信息   | 获取用户在线信息，包括用户在线状态、用户位置（如果客户端有提供此数据）、用户在线设备类型与用户在线设备登陆时间 | GET /users/statuses     | 0.8.0 ✔      |
| 修改用户在线状态   | 修改用户在线状态，可用于强制用户下线。不可修改下线用户的在线状态 | PUT /users/statuses     | 0.8.0 ✔      |
| 获取用户附近的人   | 根据该用户的最新坐标，获取其附近的其他用户的ID（主要：此服务要求此用户客户端有提供用户坐标数据） | GET /users/users-nearby | 0.8.0 ✔      |
| 获取用户的历史坐标 | 获取用户的所有历史坐标，每个坐标信息由必有的具体坐标、时间戳，以及可能为空的地址与地点名称组成 | GET /users/locations    | 0.8.0 ✔      |

### 用户关系管理

概念区分：在Turms中，
①“关系人”（Related Users）指的是存在“好友”或“拉黑用户”关系的、不管在不在联系人列表的两名用户，因此在“关系人分组”里即可以有好友，也可以有拉黑用户。**关系人记录中最重要的信息就是二者“是否是联系人”与“用户关系（好友/拉黑用户）”**
②“联系人”（Contacts）指的是存在“好友”或“拉黑用户”关系的、在联系人列表的两名用户，因此“联系人”必定是“关系人”，但“关系人”不一定是“联系人”。
在一般的社交应用中，“关系人分组”概念被“缩小”使用，仅用于表示“具有好友关系的联系人分组”。

| **功能**           | **描述**                                                     | **URL**                           | **实现版本** |
| :----------------- | :----------------------------------------------------------- | :-------------------------------- | ------------ |
| 获取用户关系人名单 | 根据可选的过滤（如“是否是联系人”、“是否是好友/拉黑用户”等）与分组条件，获取用户的关系人名单 | GET /users/relationships          | 0.8.0 ✔      |
| 移除关系人         | 根据可选的过滤条件（如“是否是联系人”、“是否是好友/拉黑用户”等），移除用户关系人列表中的某类用户或指定用户 | DELETE /users/relationships       | 0.8.0 ✔      |
| 修改关系人信息     | 修改与关系人的关系。如设定“是否是联系人”、转变具体关系为“好友”或“拉黑用户” | PUT /users/relationships          | 0.8.0 ✔      |
| 新建关系人分组     |                                                              | POST /users/relationships-group   | 0.8.0 ✔      |
| 修改关系人分组     |                                                              | PUT /users/relationships-group    | 0.8.0 ✔      |
| 删除关系人分组     |                                                              | DELETE /users/relationships-group | 0.8.0 ✔      |
| 获取关系人所在分组 |                                                              | GET /users/relationships/group    | 0.8.0 ✔      |
| 添加关系人至分组   |                                                              | POST /users/relationships/group   | 0.8.0 ✔      |
| 将关系人移除分组   |                                                              | DELETE /users/relationships/group | 0.8.0 ✔      |

### 群组管理

| **功能**                   | **描述**                                                     | **URL**           | **实现版本** |
| :------------------------- | :----------------------------------------------------------- | :---------------- | ------------ |
| 获取群组信息（可分页）     | 根据过滤条件，获取全部或指定的群组信息                       | GET /groups       | 0.8.0 ✔      |
| 获取一个用户参与的所有群组 | 根据用户 ID 获取此用户加入的全部群组信息                     | GET /users/groups | 0.8.0 ✔      |
| 创建群组                   | 创建新群组                                                   | POST /groups      | 0.8.0 ✔      |
| 修改群组信息               | 修改群组的信息。包括转让群主身份、修改群组类型、修改群组禁言状态等操作 | PUT /groups       | 0.8.0 ✔      |
| 删除群组                   | 根据过滤条件，删除群组                                       | DELETE /groups    | 0.8.0 ✔      |

### 群组成员管理

| **功能**         | **描述**                                                     | **URL**                | **实现版本** |
| :--------------- | :----------------------------------------------------------- | :--------------------- | ------------ |
| 获取群组成员     | 根据过滤条件（如“被禁言用户”、“某身份”），获取一个群组的群成员列表 | GET /groups/members    | 0.8.0 ✔      |
| 添加群组成员     | 添加用户至群组成员列表。可添加指定身份的成员                 | POST /groups/members   | 0.8.0 ✔      |
| 移除群组成员     | 根据过滤条件（如“被禁言用户”、“某身份”），从群组成员列表中移除用户 | DELETE /groups/members | 0.8.0 ✔      |
| 修改群组成员信息 | 根据过滤条件（如“被禁言用户”、“某身份”），修改群组成员信息   | PUT /groups/members    | 0.8.0 ✔      |

提醒：群组的禁言状态是指在某个时间段整个群组成员无法进行发言操作（群创建者Creator这个身份也是无权发言的，只有群所有者Owner与群管理员Admin在群禁言期间能发言）；群组成员的禁言状态是指在某个时间段某个群组成员无法进行发言操作，但其他未被禁言的成员仍可以发言。

### 群组黑名单管理

| **功能**                 | **描述**                     | **URL**                   | **实现版本** |
| ------------------------ | ---------------------------- | ------------------------- | ------------ |
| 查询群组黑名单           | 查看群组的黑名单列表         | GET /groups/blacklists    | 0.8.0 ✔      |
| 添加单个用户至群组黑名单 | 将用户添加至群组的黑名单列表 | POST /groups/blacklists   | 0.8.0 ✔      |
| 批量从群组黑名单移除用户 | 将用户从黑名单列表中移除     | DELETE /groups/blacklists | 0.8.0 ✔      |

### 群组类型管理

| **功能**           | **描述**                                                     | **URL**              | **实现版本** |
| ------------------ | ------------------------------------------------------------ | -------------------- | ------------ |
| 查询已有群组类型   | 查询已有群组类型。默认数据库中包括一个名为“GROUP”类型的群组类型 | GET /groups/types    | 0.8.0 ✔      |
| 增加自定义群组类型 | 新增自定义的群组类型，来对群组做各种各样的定制化配置         | POST /groups/types   | 0.8.0 ✔      |
| 删除群组类型       | 删除群组类型                                                 | DELETE /groups/types | 0.8.0 ✔      |
| 修改群组类型的配置 | 修改已存在群组类型的配置                                     | PUT /groups/types    | 0.8.0 ✔      |

## 集群管理

| **功能**                 | **描述**                                                     | **URL**             | **实现版本** |
| ------------------------ | ------------------------------------------------------------ | ------------------- | ------------ |
| 获取当前集群服务节点信息 |                                                              | GET /cluster        | 0.8.0 ✔      |
| 获取当前配置             | 获取当前集群中服务节点的统一配置。<br />通过/cluster/config?mutable=true可仅获取可动态修改的配置项 | GET /cluster/config | 0.8.0 ✔      |
| 修改配置                 | 动态修改集群节点的配置<br />（长期采用的过渡方案）基于Hazelcast的2PC协议与Hazelcast的ReplicatedMap实现 | PUT /cluster/config | 0.8.0 ✔      |

## RoadMap：

| **功能**             | **实现概要**                                                 | **说明**                                       | **实现版本** |
| :------------------- | ------------------------------------------------------------ | :--------------------------------------------- | :----------- |
| 支持插件             | 用户实现TurmsPlugin抽象类的子类，并生成jar包。Turms读取用户自定义jar包以使自定义插件生效 | 支持插件                                       | 0.9.0 ❓      |
| 服务端用户消息查询   | 基于TurmsClientMessagePlugin类，引入ElasticSearch集群实现    | 开发者通过这套接口来快速查询数据库中的用户消息 | 1.x ❓        |
| 垃圾信息与敏感词过滤 | 预计基于AC自动机算法实现（待定）                             | 垃圾信息与敏感词过滤                           | 1.x ❓        |
| 消息推送             | 特别注意：消息推送的实现关键点在于：在手机端上，用户的手机系统允许您的应用后台运行，否则后台消息推送功能是无法实现的 |                                                | 1.x ❓        |
| 对话机器人           |                                                              | 对话机器人                                     | 1.x ❓        |
| 文件集群管理         | （插件）基于TurmsClientMessagePlugin类，引入seaweedfs（待定）集群实现 | 文件集群管理                                   | 2.x ❓        |
| 音频通话             | 引入SRS集群（待定）实现                                      | 音频通话                                       | 3.x ❓        |
| 视频通话             | 引入SRS集群（待定）实现                                      | 视频通话                                       | 3.x ❓        |
| 语音识别             |                                                              | 语音识别                                       | 4.x ❓        |
| 跨集群通信           |                                                              | 跨集群通信                                     | x.x ❓        |

### 其他计划：

- 提供更完善的开发者文档
- 完善状态码（如将笼统的状态码定制成特指的状态码）
- 为各种即时通信业务场景提供默认配置
- 代码细节优化、数据库表结构优化
- 提高单元测试覆盖率到80%，完善集成测试，并提供压力测试与性能测试数据

## 其他文档资料

### Turms服务端配置参数详解（TODO）

### Turms服务端状态码（TODO）

### Turms服务端集成开发文档（RESTful API接口）（TODO）

### Turms架构实现与关键功能实现原理（TODO）
